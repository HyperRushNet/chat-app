<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/5962/5962463.png">
    <title>HyperRush Chat</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Modern Dark Grey Theme & Larger Fonts */
        :root {
            --bg: #ffffff;
            --surface: #ffffff;
            --border: #e5e5ea;
            --text-main: #1c1c1e;
            --text-mute: #8e8e93;
            --accent: #1c1c1e; /* Changed to Dark Grey */
            --accent-light: #f2f2f7;
            --danger: #ff3b30;
            --success: #34c759;
            --warning: #ff9500;
            --radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Plus Jakarta Sans', sans-serif;
            -webkit-tap-highlight-color: transparent
        }

        ::-webkit-scrollbar {
            width: 0;
            height: 0
        }

        body {
            height: 100dvh;
            background: #f2f2f7;
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px; /* Base font larger */
        }

        #app {
            width: 100%;
            max-width: 440px;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 80px rgba(0, 0, 0, .08);
            background: var(--bg);
            overflow: hidden
        }

        .screen {
            display: none;
            padding: 24px; /* More padding */
            inset: 0;
            background: var(--bg);
            position: absolute;
            will-change: transform, opacity;
            transition: transform .35s cubic-bezier(.16, 1, .3, 1), opacity .35s;
            flex-direction: column
        }

        .screen.active {
            display: flex;
            animation: .2s ease-out instantFade
        }

        .screen.slide-left {
            transform: translateX(-100%);
            opacity: 0
        }

        .screen.slide-right {
            transform: translateX(100%);
            opacity: 0
        }

        @keyframes instantFade {
            from {
                opacity: 0
            }

            to {
                opacity: 1
            }
        }

        .center-content {
            justify-content: center;
            align-items: center;
            text-align: center
        }

        h1.title {
            font-size: 32px; /* Larger Title */
            letter-spacing: -1.5px;
            color: #000;
            font-weight: 800;
            margin-bottom: 6px
        }

        .subtitle {
            text-transform: uppercase;
            color: var(--text-mute);
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 1px;
            margin-bottom: 32px;
            display: block
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 0 0 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
            flex-shrink: 0
        }

        .online-indicator {
            display: inline-flex;
            gap: 6px;
            background: rgba(52, 199, 89, .12);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            color: var(--success) !important;
            font-weight: 700;
            align-items: center
        }

        .dot {
            width: 6px;
            height: 6px;
            background: var(--success) !important;
            border-radius: 50%;
            animation: 2s ease-in-out infinite pulse
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1)
            }

            50% {
                opacity: .5;
                transform: scale(.8)
            }
        }

        .input-field {
            color: var(--text-main);
            width: 100%;
            background: #f2f2f7;
            border: 1px solid transparent;
            border-radius: var(--radius);
            padding: 16px; /* Larger padding */
            font-size: 16px; /* Larger font */
            outline: 0;
            margin-bottom: 16px;
            transition: .2s
        }

        .input-field:focus {
            border-color: var(--text-mute);
            background: #fff
        }

        .btn {
            color: #fff;
            width: 100%;
            height: 54px; /* Taller buttons */
            border-radius: var(--radius);
            border: none;
            background: var(--accent); /* Dark Grey buttons */
            font-weight: 700;
            font-size: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: .15s;
            cursor: pointer
        }

        .btn-accent {
            background: var(--accent);
            color: #fff
        }
        
        .btn-outline {
            background: transparent;
            color: var(--text-main);
            border: 2px solid var(--border);
        }

        .btn:active {
            transform: scale(.98);
            opacity: .8
        }

        #toast-container {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999999;
            width: 85%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center
        }

        .toast-item {
            background: rgba(28, 28, 30, .95);
            backdrop-filter: blur(20px);
            color: #fff;
            padding: 14px 20px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 14px;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, .2);
            animation: .25s cubic-bezier(.2, 1, .3, 1) slideUp;
            pointer-events: auto;
            cursor: pointer;
            width: 100%;
            margin-bottom: 8px
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0
            }

            to {
                transform: translateY(0);
                opacity: 1
            }
        }

        #block-overlay, #capacity-overlay, #offline-screen {
            position: absolute;
            inset: 0;
            background: var(--bg);
            z-index: 6000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center
        }

        #block-overlay.active, #capacity-overlay.active, #offline-screen.active {
            display: flex
        }

        #loader-overlay {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, .98);
            z-index: 3500;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 12px;
            opacity: 0
        }

        #loader-overlay.active {
            display: flex;
            opacity: 1
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: .5s linear infinite spin
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        .loader-text {
            font-size: 13px;
            font-weight: 700;
            margin-top: 6px;
            color: var(--text-mute)
        }

        .room-card {
            padding: 16px;
            border-radius: var(--radius);
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid var(--border);
            margin-bottom: 10px;
            width: 100%;
            transition: .15s;
            cursor: pointer
        }

        .room-card:active {
            transform: scale(.99);
            background: #f9f9f9
        }

        .room-name {
            flex: 1;
            min-width: 0;
            font-weight: 700;
            font-size: 16px;
            margin-right: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis
        }

        .room-icon {
            flex-shrink: 0;
            color: var(--text-mute)
        }

        #chat-messages {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
            background: var(--bg)
        }

        .date-divider {
            position: sticky;
            top: 0;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0 4px
        }

        .date-label {
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: .5px;
            margin: 0 auto;
            background: var(--bg);
            padding: 4px 0;
            font-size: 10px;
            text-align: center;
            color: var(--text-mute)
        }

        .msg {
            position: relative;
            max-width: 85%;
            padding: 10px 14px;
            border-radius: 18px;
            background: #f2f2f7;
            font-size: 15px; /* Larger chat font */
            line-height: 1.4;
            display: flex;
            flex-direction: column;
            white-space: pre-wrap;
            word-break: break-word;
            width: fit-content;
            margin-top: 4px
        }

        .msg.me {
            align-self: flex-end;
            background: var(--accent); /* Dark Grey bubbles for me */
            color: #fff;
            border-bottom-right-radius: 4px
        }

        .msg.not-me {
            align-self: flex-start;
            border-bottom-left-radius: 4px
        }

        .msg.group-start {
            margin-top: 16px
        }

        .msg-header {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 4px
        }

        .msg-user {
            font-size: 11px;
            color: var(--accent);
            cursor: pointer;
            font-weight: 700
        }

        .msg.me .msg-user {
            color: rgba(255, 255, 255, .7)
        }

        .msg-time {
            font-size: 9px;
            opacity: .4;
            text-align: right;
            margin-top: 2px;
            align-self: flex-end
        }

        .msg-continuation .msg-header {
            display: none
        }

        .msg-continuation {
            margin-top: 2px
        }

        .msg-continuation.msg.me {
            border-radius: 18px 4px 4px 18px
        }

        .msg-continuation.msg.not-me {
            border-radius: 4px 18px 18px 4px
        }

        .msg.me.group-start {
            border-radius: 18px 18px 4px 18px
        }

        .msg.not-me.group-start {
            border-radius: 18px 18px 18px 4px
        }

        #context-tooltip {
            position: fixed;
            background: rgba(0, 0, 0, .85);
            color: #fff;
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 12px;
            z-index: 99999;
            pointer-events: none;
            opacity: 0;
            transform: scale(.9);
            transition: opacity .15s, transform .15s;
            backdrop-filter: blur(10px)
        }

        #context-tooltip.active {
            opacity: 1;
            transform: scale(1)
        }

        .guest-pill {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 1px 6px;
            border-radius: 6px;
            background: rgba(0, 0, 0, .08);
            font-size: 8px;
            font-weight: 800;
            text-transform: uppercase;
            color: var(--text-main)
        }

        .msg.me .guest-pill {
            background: rgba(255, 255, 255, .15);
            color: #fff
        }

        .chat-header-main {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0
        }

        .chat-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #f2f2f7;
            overflow: hidden;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            font-weight: 800;
            font-size: 14px
        }

        .chat-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover
        }

        .chat-header-title-wrapper {
            display: flex;
            flex-direction: column;
            min-width: 0
        }

        .chat-header-title-wrapper .title {
            font-size: 18px;
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: left
        }

        .chat-subtitle {
            font-size: 10px;
            color: var(--text-mute);
            text-transform: uppercase;
            letter-spacing: .5px;
            font-weight: 600
        }
        
        /* Profile Button in Header */
        .profile-header-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #f2f2f7;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--text-mute);
            font-size: 12px;
        }
        .profile-header-btn img {
            width: 100%; 
            height: 100%; 
            object-fit: cover;
        }

        .step-container {
            position: relative;
            overflow: hidden;
            width: 100%
        }

        .wizard-step {
            display: none;
            flex-direction: column;
            gap: 14px;
            width: 100%;
            animation: .3s ease stepFade
        }

        .wizard-step.active {
            display: flex
        }

        @keyframes stepFade {
            from {
                opacity: 0;
                transform: translateX(20px)
            }

            to {
                opacity: 1;
                transform: translateX(0)
            }
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px
        }

        .step-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
            transition: all .2s
        }

        .step-dot.active {
            background: var(--accent);
            width: 24px;
            border-radius: 4px
        }

        .type-card {
            padding: 18px;
            border-radius: var(--radius);
            background: #fff;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: .15s;
            display: flex;
            align-items: center;
            gap: 14px;
            width: 100%;
            text-align: left;
            margin-bottom: 10px
        }

        .type-card:active {
            transform: scale(.99)
        }

        .type-card.selected {
            border-color: var(--text-main);
            background: rgba(28, 28, 30, .03)
        }

        .type-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: #f2f2f7;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-main)
        }

        .type-info h4 {
            font-size: 15px;
            margin-bottom: 2px;
            font-weight: 700
        }

        .type-info p {
            font-size: 12px;
            color: var(--text-mute)
        }

        /* Avatar Selector */
        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 14px
        }

        .avatar-option {
            aspect-ratio: 1;
            border-radius: var(--radius);
            border: 2px solid var(--border);
            cursor: pointer;
            overflow: hidden;
            background: #f2f2f7;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: .15s
        }

        .avatar-option img {
            width: 100%;
            height: 100%;
            object-fit: cover
        }

        .avatar-option.selected {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(28, 28, 30, .1)
        }

        /* Panels */
        #overlay-container {
            position: absolute;
            background: rgba(0, 0, 0, .5);
            z-index: 5000;
            align-items: center;
            justify-content: center;
            transition: opacity .3s;
            backdrop-filter: blur(20px);
            opacity: 0;
            display: none;
            padding: 20px;
            inset: 0
        }

        #overlay-container.active {
            display: flex;
            opacity: 1
        }

        .panel-card {
            background: var(--bg);
            width: 100%;
            max-width: 360px;
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, .25);
            animation: .4s cubic-bezier(.16, 1, .3, 1) panelSlide;
            max-height: 80vh;
            overflow-y: auto
        }

        @keyframes panelSlide {
            from {
                transform: translateY(40px);
                opacity: 0
            }

            to {
                transform: translateY(0);
                opacity: 1
            }
        }

        .view-content {
            display: none
        }

        .view-content.active {
            display: block
        }

        /* Misc */
        .access-summary-card {
            width: 100%;
            background: #f2f2f7;
            border-radius: var(--radius);
            padding: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: .15s;
            margin-bottom: 14px
        }

        .flex-sb-aic-w100-p18-bg-br12-mb20 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 14px;
            background: #f2f2f7;
            border-radius: var(--radius);
            margin-bottom: 14px
        }

        .w-48 {
            width: 48px
        }

        .h-48 {
            height: 48px
        }

        .mb-24 {
            margin-bottom: 24px
        }

        .c-danger {
            color: var(--danger)
        }

        .c-warning {
            color: var(--warning)
        }

        .c-main {
            color: var(--text-main)
        }

        .c-accent {
            color: var(--accent)
        }

        .mb-48 {
            margin-bottom: 48px
        }

        .mt-24 {
            margin-top: 24px
        }

        .w-100 {
            width: 100%
        }

        .mt-12 {
            margin-top: 12px
        }

        .bn {
            border: none
        }

        .mb-20 {
            margin-bottom: 20px
        }

        .c-mute {
            color: var(--text-mute)
        }

        .fs-12 {
            font-size: 12px
        }

        .flex-1 {
            flex: 1
        }

        .flex-gap12-mt20 {
            display: flex;
            gap: 12px;
            margin-top: 20px
        }

        .m-0-flex-1 {
            margin: 0;
            flex: 1
        }

        .w-80 {
            width: 80px
        }

        .mb-16 {
            margin-bottom: 16px
        }

        .flex-s0 {
            flex-shrink: 0
        }

        .dn {
            display: none
        }

        .w-20 {
            width: 20px
        }

        .h-20 {
            height: 20px
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 28px
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0
        }

        .slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background-color: #ccc;
            transition: .2s;
            border-radius: 28px
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: #fff;
            transition: .2s;
            border-radius: 50%
        }

        input:checked+.slider {
            background-color: var(--accent)
        }

        input:checked+.slider:before {
            transform: translateX(20px)
        }
    </style>
</head>
<body>
<div id="app">
    <div id="capacity-overlay">
        <i data-lucide="users" class="w-48 h-48 mb-24 c-danger"></i>
        <h1 class="title">Network Full</h1>
        <p class="subtitle mb-48">Maximum capacity reached.</p>
        <button class="btn btn-accent" onclick="window.retryConnection()">Retry</button>
    </div>
    <div id="overlay-container">
        <div class="panel-card">
            <!-- Hub Removed, Direct Profile View -->
            <div id="view-my-account" class="view-content active">
                <h3 style="font-weight:800;font-size:18px;margin-bottom:20px">My Account</h3>
                <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:20px">
                    <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px">
                        <div id="acc-avatar-preview" class="chat-avatar" style="width:48px;height:48px;font-size:18px">?</div>
                        <div><div id="my-acc-name" style="font-weight:800;font-size:16px">---</div><div id="my-acc-type" style="font-size:11px;color:var(--text-mute)">---</div></div>
                    </div>
                    <div style="padding:12px;background:#f2f2f7;border-radius:12px;cursor:pointer" onclick="window.copyMyId()">
                        <span style="font-size:9px;color:var(--text-mute);text-transform:uppercase;letter-spacing:.5px;font-weight:800">Unique ID (Tap to Copy)</span>
                        <br>
                        <span id="my-acc-id" style="font-size:12px;font-family:monospace">---</span>
                    </div>
                </div>
                <button class="btn btn-accent" style="height:48px" onclick="window.closeOverlay()">Close</button>
            </div>

            <div id="view-access-manager" class="view-content">
                <div style="display:flex;flex-direction:column;gap:12px;height:100%">
                    <div style="text-align:center">
                        <h3 style="font-size:18px;font-weight:800;margin-bottom:4px">Select Users</h3>
                        <p style="font-size:12px;color:var(--text-mute)">Add users to restrict access.</p>
                    </div>
                    <div style="display:flex;gap:8px;align-items:center">
                        <input id="picker-id-input" class="input-field" placeholder="Paste User ID..." style="margin-bottom:0">
                        <button class="btn btn-accent" style="width:auto;padding:0 16px;height:48px" onclick="window.addUserById()">Add</button>
                    </div>
                    <label style="font-size:10px;color:var(--text-mute);text-transform:uppercase;letter-spacing:1px;font-weight:800">Added (<span id="picker-count">0</span>)</label>
                    <div id="picker-selected-list" style="flex:1;overflow-y:auto;padding-right:4px;max-height:200px">
                        <div style="color:var(--text-mute);padding:20px 0;font-size:12px;text-align:center">No users added.</div>
                    </div>
                    <button class="btn btn-accent" style="height:52px" onclick="window.closeAccessManager()">Done</button>
                </div>
            </div>

            <div id="view-room-settings" class="view-content">
                <div style="display:flex;justify-content:space-between;align-items:center;width:100%;margin-bottom:20px">
                    <h3 style="margin:0;font-weight:800;font-size:18px">Room Settings</h3>
                    <button style="background:rgba(255,59,48,.1);border:none;border-radius:10px;padding:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--danger)" onclick="window.deleteRoom(event)"><i data-lucide="trash-2" class="w-18 h-18"></i></button>
                </div>
                <div class="step-indicator" id="edit-step-indicator"><div class="step-dot active"></div><div class="step-dot"></div></div>
                <div class="step-container">
                    <div id="edit-step-1" class="wizard-step active">
                        <input id="edit-room-name" class="input-field" placeholder="Room Name">
                        <div class="flex-sb-aic-w100-p18-bg-br12-mb20"><span style="font-weight:600;font-size:14px">Private Room</span><label class="switch"><input type="checkbox" id="edit-room-private"><span class="slider"></span></label></div>
                        <button class="btn btn-accent" onclick="window.nextEditStep()">Next</button>
                    </div>
                    <div id="edit-step-2" class="wizard-step">
                        <div style="margin-bottom:14px">
                            <div style="display:flex;justify-content:space-between;align-items:center;width:100%;padding:0 0 8px 0">
                                <span style="font-weight:600;font-size:13px">Password</span>
                                <span id="pass-status-label" style="font-size:9px;color:var(--text-mute);text-transform:uppercase;font-weight:700">Not Set</span>
                            </div>
                            <input id="edit-room-pass" type="password" class="input-field" placeholder="Change password" autocomplete="new-password">
                            <button id="btn-remove-pass" class="btn bn c-danger fs-12" style="height:auto;padding:6px 0;display:none;justify-content:flex-start" onclick="window.prepareRemovePassword()">Remove Password</button>
                        </div>
                        <div id="edit-access-summary" class="access-summary-card" onclick="window.openAccessManager('edit-room')">
                            <span class="c-main">Public Room</span>
                            <i data-lucide="chevron-right" class="w-16 h-16"></i>
                        </div>
                        <div style="display:flex;gap:10px;margin-top:4px">
                            <button class="btn btn-outline" style="flex:1" onclick="window.prevEditStep()">Back</button>
                            <button class="btn btn-accent" style="flex:1" onclick="window.saveRoomSettings(event)">Save</button>
                        </div>
                    </div>
                </div>
                <button class="btn mt-12 bn" style="background:transparent;color:var(--text-mute)" onclick="window.closeOverlay()">Cancel</button>
            </div>
        </div>
    </div>

    <div id="block-overlay">
        <i data-lucide="copy" class="w-48 h-48 mb-24 c-warning"></i>
        <h1 class="title">Active Session</h1>
        <p class="subtitle mb-48">HRN Chat is open in another tab.</p>
        <button class="btn btn-accent" onclick="window.forceClaimMaster()">Use Here</button>
    </div>
    <div id="offline-screen">
        <i data-lucide="wifi-off" class="w-48 h-48 mb-24 c-main"></i>
        <h1 class="title">No Signal</h1>
        <p class="subtitle mb-48">Waiting for internet...</p>
    </div>
    <div id="loader-overlay" class="active">
        <div class="spinner"></div>
        <span id="loader-text" class="loader-text">Initializing...</span>
    </div>
    <div id="toast-container"></div>
    <div id="context-tooltip"></div>

    <!-- START SCREEN -->
    <div id="scr-start" class="screen active center-content">
        <i data-lucide="shield" style="width:48px;height:48px;stroke-width:1.5;color:var(--accent);margin-bottom:20px"></i>
        <h1 class="title">HRN Chat</h1>
        <p class="subtitle">Secure Network</p>
        <button class="btn btn-accent" onclick="window.nav('scr-login')">Sign In</button>
        <button class="btn btn-outline mt-12" onclick="window.nav('scr-register')">Create Account</button>
        <div style="position:absolute;bottom:40px;font-size:12px;color:var(--text-mute);opacity:.7;cursor:pointer" onclick="window.nav('scr-guest', 'left')">Use as Guest</div>
    </div>

    <!-- INVITE SCREEN -->
    <div id="scr-invite" class="screen center-content">
        <div id="invite-icon" class="chat-avatar" style="width:80px;height:80px;font-size:30px;margin-bottom:24px;background:#f2f2f7">?</div>
        <h1 id="invite-title" class="title">Group Invite</h1>
        <p id="invite-subtitle" class="subtitle" style="margin-bottom:16px">You've been invited to join</p>
        
        <div style="width:100%;background:#f2f2f7;border-radius:16px;padding:16px;margin-bottom:24px">
            <div style="font-size:10px;color:var(--text-mute);text-transform:uppercase;letter-spacing:1px;font-weight:700;margin-bottom:12px">Members</div>
            <div id="invite-members" style="display:flex;flex-wrap:wrap;justify-content:center;gap:12px;max-height:120px;overflow-y:auto">
                <!-- Members list injected here -->
                 <div style="color:var(--text-mute);font-size:13px">Loading...</div>
            </div>
        </div>

        <button class="btn btn-accent" onclick="window.joinInvite()">Join Room</button>
        <button class="btn bn mt-12" style="color:var(--text-mute)" onclick="window.nav('scr-start')">Later</button>
    </div>

    <!-- GUEST SCREEN -->
    <div id="scr-guest" class="screen center-content">
        <i data-lucide="user" style="width:36px;height:36px;color:var(--accent);margin-bottom:14px"></i>
        <h1 class="title">Guest Access</h1>
        <p class="subtitle">Persistent Session</p>
        <input id="g-name" class="input-field" placeholder="Enter Name">
        <button class="btn btn-accent" onclick="window.handleGuestLogin(event)">Enter Lobby</button>
        <button class="btn bn mt-12" style="color:var(--text-mute)" onclick="window.nav('scr-start', 'right')">Back</button>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="scr-login" class="screen center-content">
        <h1 class="title">Sign In</h1><p class="subtitle">Access Secure Room</p>
        <input id="l-email" class="input-field" type="email" placeholder="Email Address">
        <input id="l-pass" type="password" class="input-field" placeholder="Password">
        <button class="btn btn-accent" onclick="window.handleLogin(event)">Access</button>
        <button class="btn bn mt-12" style="color:var(--text-mute)" onclick="window.nav('scr-start')">Back</button>
    </div>

    <!-- REGISTER SCREEN -->
    <div id="scr-register" class="screen center-content">
        <div class="step-indicator" id="reg-step-indicator"><div class="step-dot active"></div><div class="step-dot"></div></div>
        <div class="step-container">
            <div id="reg-step-1" class="wizard-step active">
                <h1 class="title">Sign Up</h1><p class="subtitle">Step 1 of 2</p>
                <input id="r-name" class="input-field" placeholder="Full Name">
                <input id="r-email" class="input-field" type="email" placeholder="Email Address">
                <input id="r-pass" class="input-field" type="password" placeholder="Password (min. 8 chars)">
                <button class="btn btn-accent" onclick="window.nextRegStep()">Next</button>
            </div>
            <div id="reg-step-2" class="wizard-step">
                <h1 class="title">Profile</h1><p class="subtitle">Choose Avatar</p>
                <div class="avatar-grid" id="avatar-grid"></div>
                <input id="r-avatar-url" class="input-field" placeholder="Or paste Image URL...">
                <div style="display:flex;gap:10px">
                    <button class="btn btn-outline" style="flex:1" onclick="window.prevRegStep()">Back</button>
                    <button class="btn btn-accent" style="flex:1" onclick="window.handleRegister(event)">Verify</button>
                </div>
            </div>
        </div>
        <button class="btn bn mt-12" style="color:var(--text-mute)" onclick="window.nav('scr-start')">Cancel</button>
    </div>

    <!-- VERIFY SCREEN -->
    <div id="scr-verify" class="screen center-content">
        <h1 class="title">Verify</h1><p class="subtitle">Confirm Identity</p>
        <input id="v-code" class="input-field" style="text-align:center;font-size:24px;letter-spacing:8px" placeholder="000000">
        <button class="btn btn-accent" onclick="window.handleVerify(event)">Confirm</button>
        <div id="v-timer" class="mt-24" style="color:var(--accent);font-weight:800;font-size:14px">10:00</div>
    </div>

    <!-- LOBBY SCREEN -->
    <div id="scr-lobby" class="screen">
        <div class="header">
            <div style="display:flex;align-items:center;gap:10px;flex:1;min-width:0">
                <h1 class="title" style="font-size:20px;margin:0;cursor:pointer" onclick="window.refreshLobby()">Rooms</h1>
                <span class="online-indicator"><div class="dot"></div><span class="live-count">--</span></span>
            </div>
            <div style="display:flex;gap:14px;align-items:center;flex-shrink:0">
                <!-- Profile Button Replaces Hub Icon -->
                <div id="lobby-profile-btn" class="profile-header-btn" onclick="window.prepareMyAccount()">
                    <span id="lobby-avatar-initial">?</span>
                    <img id="lobby-avatar-img" src="" style="display:none">
                </div>
                <span class="clickable" id="icon-plus-lobby" onclick="window.nav('scr-create')"><i data-lucide="plus" class="w-24 h-24"></i></span>
                <span class="clickable" onclick="window.handleLogout(event)"><i data-lucide="log-out" class="w-24 h-24"></i></span>
            </div>
        </div>
        <input id="search-bar" class="input-field" placeholder="Search..." oninput="window.filterRooms()">
        <div id="room-list" class="flex-1" style="overflow-y:auto"></div>
        <div style="display:flex;gap:12px;padding-top:16px;border-top:1px solid var(--border)"><input id="join-id" class="input-field m-0-flex-1" placeholder="Direct ID"><button class="btn btn-accent w-80" onclick="window.joinPrivate()">Join</button></div>
    </div>

    <!-- CHAT SCREEN -->
    <div id="scr-chat" class="screen">
        <div class="header" style="margin-bottom:14px">
            <div class="chat-header-main">
                <span class="clickable flex-s0" onclick="window.leaveChat()"><i data-lucide="chevron-left" style="width:24px;height:24px"></i></span>
                <div class="chat-avatar" id="chat-avatar-display">?</div>
                <div class="chat-header-title-wrapper">
                    <h2 id="chat-title" class="title">---</h2>
                </div>
            </div>
            <div style="display:flex;gap:14px;align-items:center;flex-shrink:0">
                <span class="clickable dn" id="room-settings-icon" onclick="window.openRoomSettings()"><i data-lucide="settings" class="w-22 h-22"></i></span>
                <span class="clickable" id="copy-btn-wrapper" onclick="window.copyId()"><i data-lucide="copy" id="icon-copy-chat" class="w-22 h-22"></i><i data-lucide="check" id="icon-check-chat" class="w-22 h-22 dn c-success"></i></span>
            </div>
        </div>
        <div id="chat-messages" class="pos-rel">
            <div id="chat-empty-state" style="inset:0;z-index:5;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;width:100%">
                <i data-lucide="message-circle" style="width:48px;height:48px;color:#d1d1d6;margin-bottom:14px"></i>
                <div style="font-size:16px;font-weight:700;color:var(--text-main);margin-bottom:4px">No messages yet</div>
                <div style="font-size:13px;color:var(--text-mute)">Be the first to say something.</div>
            </div>
        </div>
        <div id="chat-input-area" style="display:flex;gap:12px;padding-top:14px;align-items:flex-end;border-top:1px solid var(--border)">
            <textarea id="chat-input" class="input-field" placeholder="Message..." style="height:48px;resize:none;min-height:48px;margin:0"></textarea>
            <button id="send-btn" class="btn btn-accent" style="width:48px;height:48px;padding:0" onclick="window.sendMsg(event)"><i data-lucide="arrow-up" style="width:20px;height:20px"></i></button>
        </div>
    </div>

    <!-- CREATE SCREEN -->
    <div id="scr-create" class="screen center-content">
        <div class="step-indicator" id="create-step-indicator"><div class="step-dot active"></div><div class="step-dot"></div></div>
        <div class="step-container">
            <div id="create-step-1" class="wizard-step active">
                <h1 class="title">New Chat</h1><p class="subtitle">Choose Type</p>

                <div id="type-group" class="type-card" onclick="window.selectCreateType('group')">
                    <div class="type-icon"><i data-lucide="users" class="w-22 h-22"></i></div>
                    <div class="type-info"><h4>Group Chat</h4><p>Multiple people, custom name</p></div>
                </div>

                <div id="type-direct" class="type-card" onclick="window.selectCreateType('direct')">
                    <div class="type-icon"><i data-lucide="user" class="w-22 h-22"></i></div>
                    <div class="type-info"><h4>Private Chat</h4><p>Direct message with one person</p></div>
                </div>

                <button class="btn btn-accent" onclick="window.nextCreateStep()">Next</button>
            </div>

            <div id="create-step-2" class="wizard-step">
                <h1 class="title" id="create-step2-title">Setup</h1>
                <p class="subtitle" id="create-step2-sub">Details</p>

                <div id="create-group-fields">
                    <input id="c-name" class="input-field" placeholder="Group Name">
                    <div class="flex-sb-aic-w100-p18-bg-br12-mb20"><span style="font-weight:600;font-size:14px">Private Room</span><label class="switch"><input type="checkbox" id="c-private"><span class="slider"></span></label></div>
                </div>

                <div id="create-direct-fields" class="dn">
                    <input id="c-target-user" class="input-field" placeholder="Paste User ID...">
                    <div style="font-size:12px;color:var(--text-mute);margin-top:-8px;margin-bottom:12px">Chat will be named after them.</div>
                </div>

                <div id="create-access-summary" class="access-summary-card" onclick="window.openAccessManager('create')">
                    <span class="c-main">Public Room</span>
                    <i data-lucide="chevron-right" class="w-16 h-16"></i>
                </div>

                <div style="display:flex;gap:10px">
                    <button class="btn btn-outline" style="flex:1" onclick="window.prevCreateStep()">Back</button>
                    <button class="btn btn-accent" style="flex:1" onclick="window.handleCreate(event)">Create</button>
                </div>
            </div>
        </div>
        <button class="btn bn mt-12" style="color:var(--text-mute)" onclick="window.nav('scr-lobby')">Cancel</button>
    </div>

    <!-- GATE SCREEN -->
    <div id="scr-gate" class="screen center-content">
        <h1 class="title">Encrypted</h1><p class="subtitle">Authentication Required</p>
        <input id="gate-pass" type="password" class="input-field" style="text-align:center" placeholder="Passkey">
        <button class="btn btn-accent" onclick="window.submitGate(event)">Decrypt</button>
        <button class="btn bn mt-12" style="color:var(--text-mute)" onclick="window.nav('scr-lobby')">Abort</button>
    </div>

    <!-- SUCCESS SCREEN -->
    <div id="scr-success" class="screen center-content">
        <i data-lucide="check-circle" class="w-48 h-48 mb-24 c-success"></i>
        <h1 class="title">Room Created</h1><p class="subtitle">Deployment Successful</p>
        <div id="s-id" class="input-field" style="text-align:center;color:var(--accent);font-weight:800;border:2px dashed var(--border)" onclick="window.copySId()">---</div>
        <button class="btn btn-accent" onclick="window.enterCreated()">Enter</button>
    </div>

</div>
<script type="module" src="./assets/logic.js"></script>
</body>
</html>
